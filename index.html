<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teleprompter</title>
    <style>
        /* General Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            height: 100vh;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: fixed;
            inset: 0;
        }

        /* Settings Panel */
        .settings-panel {
            background: #1f2937;
            color: white;
            padding: 1rem;
            z-index: 30;
            max-height: 50vh;
            overflow-y: auto;
            transition: max-height 0.3s ease, padding 0.3s ease;
            flex-shrink: 0;
        }

        .settings-panel.hidden {
            display: none;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .settings-header h1 {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .btn {
            padding: 0.5rem 1rem;
            background: #374151;
            border: none;
            border-radius: 0.375rem;
            color: white;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn:hover {
            background: #4b5563;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .setting-item label {
            display: block;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .setting-item input[type="range"],
        .setting-item select {
            width: 100%;
            padding: 0.5rem;
            background: #374151;
            border: none;
            border-radius: 0.375rem;
            color: white;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .checkbox-label input {
            width: 1rem;
            height: 1rem;
        }

        .script-area textarea {
            width: 100%;
            padding: 0.75rem;
            background: #374151;
            border: none;
            border-radius: 0.375rem;
            color: white;
            font-family: monospace;
            font-size: 0.875rem;
            min-height: 8rem;
            resize: vertical;
        }

        /* Teleprompter Display */
        .teleprompter-display {
            flex: 1;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }

        .teleprompter-display::before {
            content: '';
            position: absolute;
            top: 40%; /* The "read line" for the highlight */
            left: 1rem;
            right: 1rem;
            height: 1px;
            background: rgba(255, 82, 82, 0.5);
            z-index: 50;
            pointer-events: none;
        }

        .teleprompter-display.dark { background: black; color: white; }
        .teleprompter-display.light { background: white; color: black; }
        .teleprompter-display.contrast { background: #fde047; color: black; }

        .teleprompter-text {
            padding: 2rem;
            padding-bottom: 100vh; /* Ensure there's space to scroll to the end */
            line-height: 1.6;
            white-space: pre-wrap;
            transition: transform 0.3s, font-size 0.3s;
        }
        
        .teleprompter-text span {
             transition: background-color 0.2s, color 0.2s;
        }

        .teleprompter-text.mirrored {
            transform: scaleX(-1);
        }

        .highlight {
            padding: 0 0.25rem;
            border-radius: 0.25rem;
            color: white !important;
        }

        .dark .highlight { background: #2563eb; }
        .light .highlight { background: #3b82f6; }
        .contrast .highlight { background: #3b82f6; }
        
        /* Progress Bar */
        .progress-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: #374151;
            z-index: 60;
        }

        .progress-fill {
            height: 100%;
            background: #3b82f6;
            transition: width 0.1s linear;
        }

        /* Controls & Timer */
        .floating-controls {
            position: fixed;
            bottom: 1rem;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 0.75rem;
            z-index: 70;
            pointer-events: none;
            padding: 0 1rem;
        }

        .control-btn {
            background: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(5px);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            width: 3.5rem;
            height: 3.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            pointer-events: auto;
            transition: background 0.2s, transform 0.1s;
        }

        .control-btn:hover { background: #1f2937; }
        .control-btn:active { transform: scale(0.95); }
        .control-btn svg { width: 1.75rem; height: 1.75rem; }

        .timer-display {
            position: fixed;
            bottom: 5.5rem;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(5px);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 2rem;
            font-size: 1.25rem;
            font-weight: bold;
            font-family: monospace;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            z-index: 70;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .pause-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            font-size: 3rem;
            font-weight: bold;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .pause-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }
        
        /* Keyboard Help & Empty State */
        .keyboard-help {
            background: #1f2937;
            color: white;
            padding: 0.5rem;
            text-align: center;
            font-size: 0.875rem;
            flex-shrink: 0;
        }

        .keyboard-help.hidden {
            display: none;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #6b7280;
            text-align: center;
            padding: 2rem;
            display: none; /* Hidden by default */
        }
        
        .empty-state.visible {
            display: flex;
        }

        .empty-state svg {
            width: 4rem;
            height: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Settings Panel -->
        <div class="settings-panel" id="settingsPanel">
            <div class="settings-header">
                <h1>Teleprompter</h1>
                <button class="btn" id="toggleSettingsBtn">Hide Settings</button>
            </div>
            <!-- Settings content remains the same -->
            <div class="settings-grid">
                <div class="setting-item">
                    <label>Speed: <span id="speedValue">1.0</span>x</label>
                    <input type="range" id="speed" min="0.5" max="5" step="0.1" value="1">
                </div>
                <div class="setting-item">
                    <label>Font Size: <span id="fontSizeValue">48</span>px</label>
                    <input type="range" id="fontSize" min="24" max="96" step="4" value="48">
                </div>
                <div class="setting-item">
                    <label>Line Height: <span id="lineHeightValue">1.6</span></label>
                    <input type="range" id="lineHeight" min="1.2" max="2.4" step="0.1" value="1.6">
                </div>
                <div class="setting-item">
                    <label>Theme</label>
                    <select id="theme">
                        <option value="dark">Dark</option>
                        <option value="light">Light</option>
                        <option value="contrast">High Contrast</option>
                    </select>
                </div>
            </div>
            <div class="checkbox-group">
                <label class="checkbox-label"><input type="checkbox" id="mirror"> Mirror Mode</label>
                <label class="checkbox-label"><input type="checkbox" id="highlight" checked> Highlight Line</label>
                <span style="color: #9ca3af;">Est. <span id="estimatedTime">1</span> min read</span>
            </div>
            <div class="script-area">
                <label>Your Script:</label>
                <textarea id="scriptText" placeholder="Paste your script here...">Welcome to your teleprompter! Paste your script here and click play to start. 
[pause-2]
Use your keyboard: Spacebar to Play/Pause, Arrow keys to adjust speed or jump, R to Reset, and F for Fullscreen.</textarea>
            </div>
        </div>

        <!-- Teleprompter Display -->
        <div class="teleprompter-display dark" id="display">
            <div class="empty-state" id="emptyState">
                <svg fill="currentColor" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                <h3>No Script Loaded</h3>
                <p>Add your script in the settings panel to get started.</p>
            </div>
            <div class="teleprompter-text" id="text"></div>
            <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
            <div class="pause-overlay" id="pauseOverlay">
                <div id="pauseTimer"></div>
            </div>
        </div>

        <!-- Timer & Controls -->
        <div class="timer-display" id="timerDisplay">
            <span id="timerText">00:00</span>
        </div>
        <div class="floating-controls">
            <button class="control-btn" id="playBtn">
                <svg id="playIcon" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                <svg id="pauseIcon" fill="currentColor" viewBox="0 0 24 24" style="display:none;"><path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/></svg>
            </button>
            <button class="control-btn" id="resetBtn">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg>
            </button>
            <button class="control-btn" id="settingsBtn">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m5.7-11.7 4.2-4.2m-14.1 0 4.2 4.2m10.6 10.6-4.2-4.2m-10.6 0-4.2 4.2"/></svg>
            </button>
        </div>

        <!-- Keyboard Help -->
        <div class="keyboard-help" id="keyboardHelp">
            <span><b>Space</b>: Play/Pause</span> | <span><b>↑↓</b>: Speed</span> | <span><b>←→</b>: Jump</span> | <span><b>R</b>: Reset</span> | <span><b>F</b>: Fullscreen</span>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- State Variables ---
        let isPlaying = false;
        let isPausedForCommand = false;
        let pauseCountdown = 0;
        let speed = 1;
        let scrollPosition = 0;
        let animationFrame = null;
        let lastTime = 0;
        let scriptWords = [];
        let wordSpans = [];
        let pauseCommands = {};
        let currentWordIndex = 0;
        let timerSeconds = 0;
        let timerInterval = null;
        
        let wpm = speed * 180;
        let timePerWord = wpm > 0 ? 60000 / wpm : Infinity;
        let timeSinceLastWord = 0;


        // --- DOM Elements ---
        const DOMElements = {
            display: document.getElementById('display'),
            textElement: document.getElementById('text'),
            progressFill: document.getElementById('progressFill'),
            playBtn: document.getElementById('playBtn'),
            playIcon: document.getElementById('playIcon'),
            pauseIcon: document.getElementById('pauseIcon'),
            resetBtn: document.getElementById('resetBtn'),
            settingsBtn: document.getElementById('settingsBtn'),
            settingsPanel: document.getElementById('settingsPanel'),
            toggleSettingsBtn: document.getElementById('toggleSettingsBtn'),
            keyboardHelp: document.getElementById('keyboardHelp'),
            timerDisplay: document.getElementById('timerDisplay'),
            timerText: document.getElementById('timerText'),
            emptyState: document.getElementById('emptyState'),
            pauseOverlay: document.getElementById('pauseOverlay'),
            pauseTimer: document.getElementById('pauseTimer'),
            speedInput: document.getElementById('speed'),
            fontSizeInput: document.getElementById('fontSize'),
            lineHeightInput: document.getElementById('lineHeight'),
            themeSelect: document.getElementById('theme'),
            mirrorCheck: document.getElementById('mirror'),
            highlightCheck: document.getElementById('highlight'),
            scriptTextArea: document.getElementById('scriptText'),
            speedValue: document.getElementById('speedValue'),
            fontSizeValue: document.getElementById('fontSizeValue'),
            lineHeightValue: document.getElementById('lineHeightValue'),
            estimatedTime: document.getElementById('estimatedTime'),
        };

        // --- Core Functions ---
        const renderScript = () => {
            const rawText = DOMElements.scriptTextArea.value;
            pauseCommands = {};
            
            const pauseRegex = /\[pause-(\d+(\.\d+)?)\]/g;
            const cleanedText = rawText.replace(pauseRegex, '');
            
            if (cleanedText.trim() === '') {
                DOMElements.emptyState.classList.add('visible');
                DOMElements.textElement.style.display = 'none';
                scriptWords = [];
                wordSpans = [];
                return;
            }
            
            DOMElements.emptyState.classList.remove('visible');
            DOMElements.textElement.style.display = 'block';

            let match;
            let cumulativeLength = 0;
            let lastIndex = 0;
            // First, find where the pauses should be relative to word count
            while((match = pauseRegex.exec(rawText)) !== null) {
                const textBeforePause = rawText.substring(lastIndex, match.index);
                const wordsBefore = textBeforePause.split(/\s+/).filter(w => w.length > 0).length;
                cumulativeLength += wordsBefore;
                pauseCommands[cumulativeLength -1] = parseFloat(match[1]);
                lastIndex = match.index + match[0].length;
            }

            const scriptTokens = cleanedText.split(/(\s+)/);
            scriptWords = cleanedText.split(/\s+/).filter(w => w.length > 0);
            
            let html = '';
            let wordCounter = 0;
            scriptTokens.forEach(token => {
                if (/\s+/.test(token)) {
                    html += token.replace(/\n/g, '<br>');
                } else if (token) {
                    html += `<span data-word-index="${wordCounter}">${token}</span>`;
                    wordCounter++;
                }
            });
            DOMElements.textElement.innerHTML = html;

            wordSpans = Array.from(DOMElements.textElement.querySelectorAll('span[data-word-index]'));
            
            if (DOMElements.highlightCheck.checked && wordSpans.length > 0) {
                 wordSpans[0].classList.add('highlight');
            }
            
            DOMElements.estimatedTime.textContent = Math.ceil(scriptWords.length / 150);
        };

        const findWordAtY = (yPos) => {
            if (!wordSpans || wordSpans.length === 0) return 0;
            let low = 0, high = wordSpans.length - 1, bestGuess = 0;
            while (low <= high) {
                const mid = Math.floor((low + high) / 2);
                if (wordSpans[mid].offsetTop < yPos) {
                    bestGuess = mid;
                    low = mid + 1;
                } else {
                    high = mid - 1;
                }
            }
            return bestGuess;
        };

        const animate = (currentTime) => {
            if (!isPlaying) return;

            if (!lastTime) lastTime = currentTime;
            const deltaTime = currentTime - lastTime;
            lastTime = currentTime;

            // Handle inline pause commands
            if (isPausedForCommand) {
                pauseCountdown -= deltaTime;
                DOMElements.pauseTimer.textContent = (pauseCountdown / 1000).toFixed(1);
                if (pauseCountdown <= 0) {
                    isPausedForCommand = false;
                    DOMElements.pauseOverlay.classList.remove('visible');
                }
                animationFrame = requestAnimationFrame(animate);
                return;
            }

            // --- Word Highlight Advancement based on WPM ---
            timeSinceLastWord += deltaTime;
            if (timeSinceLastWord >= timePerWord) {
                timeSinceLastWord %= timePerWord; 
                
                // Check for a pause command *before* advancing the word
                if(pauseCommands[currentWordIndex]) {
                    isPausedForCommand = true;
                    pauseCountdown = pauseCommands[currentWordIndex] * 1000;
                    DOMElements.pauseOverlay.classList.add('visible');
                    animationFrame = requestAnimationFrame(animate);
                    return;
                }

                if (currentWordIndex < wordSpans.length - 1) {
                    wordSpans[currentWordIndex]?.classList.remove('highlight');
                    currentWordIndex++;
                    wordSpans[currentWordIndex]?.classList.add('highlight');
                } else {
                    togglePlay();
                    return; 
                }
            }

            // --- Scrolling to Follow Highlight ---
            if (wordSpans.length > 0 && wordSpans[currentWordIndex]) {
                const currentWordTop = wordSpans[currentWordIndex].offsetTop;
                const guideLineY = DOMElements.display.clientHeight * 0.4;
                const targetScrollPosition = currentWordTop - guideLineY;
                
                const scrollDifference = targetScrollPosition - scrollPosition;
                scrollPosition += scrollDifference * 0.08; 

                const maxScroll = DOMElements.display.scrollHeight - DOMElements.display.clientHeight;
                scrollPosition = Math.max(0, Math.min(scrollPosition, maxScroll));
                DOMElements.display.scrollTop = scrollPosition;

                const progress = (maxScroll > 0) ? (currentWordIndex / (wordSpans.length -1)) * 100 : 0;
                DOMElements.progressFill.style.width = `${progress}%`;
            }

            animationFrame = requestAnimationFrame(animate);
        };
        
        const togglePlay = () => {
            if (scriptWords.length === 0) return;
            isPlaying = !isPlaying;
            DOMElements.playIcon.style.display = isPlaying ? 'none' : 'block';
            DOMElements.pauseIcon.style.display = isPlaying ? 'block' : 'none';
            updateKeyboardHelp();
            
            if (isPlaying) {
                lastTime = 0;
                if (!isPausedForCommand) timeSinceLastWord = 0;
                if (animationFrame) cancelAnimationFrame(animationFrame);
                animationFrame = requestAnimationFrame(animate);
                startTimer();
            } else {
                if (animationFrame) cancelAnimationFrame(animationFrame);
                animationFrame = null;
                pauseTimer();
            }
        };
        
        const reset = () => {
            if (isPlaying) togglePlay();
            isPausedForCommand = false;
            DOMElements.pauseOverlay.classList.remove('visible');
            scrollPosition = 0;
            lastTime = 0;

            if (wordSpans[currentWordIndex]) {
                wordSpans[currentWordIndex].classList.remove('highlight');
            }
            currentWordIndex = 0;
            if (DOMElements.highlightCheck.checked && wordSpans[0]) {
                wordSpans[0].classList.add('highlight');
            }

            DOMElements.display.scrollTop = 0;
            DOMElements.progressFill.style.width = '0%';
            resetTimer();
        };

        const maintainHighlightPosition = () => {
            DOMElements.display.offsetHeight; 
            if (wordSpans.length === 0 || !wordSpans[currentWordIndex]) return;

            const currentWordTop = wordSpans[currentWordIndex].offsetTop;
            const guideLineY = DOMElements.display.clientHeight * 0.4;
            let newScrollPosition = currentWordTop - guideLineY;

            const maxScroll = DOMElements.display.scrollHeight - DOMElements.display.clientHeight;
            newScrollPosition = Math.max(0, Math.min(newScrollPosition, maxScroll));
            
            scrollPosition = newScrollPosition;
            
            if (!isPlaying) {
                DOMElements.display.scrollTop = scrollPosition;
            }
        }

        const toggleSettings = () => {
            DOMElements.settingsPanel.classList.toggle('hidden');
            DOMElements.toggleSettingsBtn.textContent = DOMElements.settingsPanel.classList.contains('hidden') ? 'Show Settings' : 'Hide Settings';
            updateKeyboardHelp();
            requestAnimationFrame(maintainHighlightPosition);
        };
        
        const updateHighlightAfterJump = () => {
            if (isPlaying) return;
            const guideLineY = DOMElements.display.clientHeight * 0.4;
            const textYAtGuideLine = DOMElements.display.scrollTop + guideLineY;
            const newWordIndex = findWordAtY(textYAtGuideLine);
            if (newWordIndex !== currentWordIndex) {
                wordSpans[currentWordIndex]?.classList.remove('highlight');
                wordSpans[newWordIndex]?.classList.add('highlight');
                currentWordIndex = newWordIndex;
            }
        };
        
        // --- UI & Timer Updates ---
        const updateKeyboardHelp = () => {
            const settingsHidden = DOMElements.settingsPanel.classList.contains('hidden');
            DOMElements.keyboardHelp.classList.toggle('hidden', settingsHidden || isPlaying);
        };
        const updateTimerDisplay = () => {
            const minutes = String(Math.floor(timerSeconds / 60)).padStart(2, '0');
            const seconds = String(timerSeconds % 60).padStart(2, '0');
            DOMElements.timerText.textContent = `${minutes}:${seconds}`;
        };
        const startTimer = () => {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => { timerSeconds++; updateTimerDisplay(); }, 1000);
        };
        const pauseTimer = () => clearInterval(timerInterval);
        const resetTimer = () => {
            timerSeconds = 0;
            updateTimerDisplay();
            clearInterval(timerInterval);
            timerInterval = null;
        };

        // --- Event Listeners ---
        DOMElements.playBtn.addEventListener('click', togglePlay);
        DOMElements.resetBtn.addEventListener('click', reset);
        DOMElements.settingsBtn.addEventListener('click', toggleSettings);
        DOMElements.toggleSettingsBtn.addEventListener('click', toggleSettings);
        DOMElements.display.addEventListener('click', (e) => {
            if (e.target.closest('.control-btn')) return;
            togglePlay();
        });
        DOMElements.scriptTextArea.addEventListener('input', () => { reset(); renderScript(); });

        DOMElements.speedInput.addEventListener('input', e => {
            speed = parseFloat(e.target.value);
            DOMElements.speedValue.textContent = speed.toFixed(1);
            wpm = speed * 180;
            timePerWord = wpm > 0 ? 60000 / wpm : Infinity;
        });
        DOMElements.fontSizeInput.addEventListener('input', e => {
            DOMElements.textElement.style.fontSize = `${e.target.value}px`;
            DOMElements.fontSizeValue.textContent = e.target.value;
            maintainHighlightPosition();
        });
        DOMElements.lineHeightInput.addEventListener('input', e => {
            DOMElements.textElement.style.lineHeight = e.target.value;
            DOMElements.lineHeightValue.textContent = parseFloat(e.target.value).toFixed(1);
            maintainHighlightPosition();
        });
        DOMElements.themeSelect.addEventListener('change', e => { DOMElements.display.className = `teleprompter-display ${e.target.value}`; });
        DOMElements.mirrorCheck.addEventListener('change', e => { DOMElements.textElement.classList.toggle('mirrored', e.target.checked); });
        DOMElements.highlightCheck.addEventListener('change', e => {
             if (e.target.checked) wordSpans[currentWordIndex]?.classList.add('highlight');
             else wordSpans[currentWordIndex]?.classList.remove('highlight');
        });

        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'TEXTAREA') return;
            
            switch(e.key) {
                case ' ': e.preventDefault(); togglePlay(); break;
                case 'ArrowUp': 
                    e.preventDefault();
                    DOMElements.speedInput.value = Math.min(parseFloat(DOMElements.speedInput.value) + 0.1, 5).toFixed(1);
                    DOMElements.speedInput.dispatchEvent(new Event('input'));
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    DOMElements.speedInput.value = Math.max(parseFloat(DOMElements.speedInput.value) - 0.1, 0.5).toFixed(1);
                    DOMElements.speedInput.dispatchEvent(new Event('input'));
                    break;
                case 'ArrowLeft': 
                    e.preventDefault();
                    DOMElements.display.scrollTop -= 150; 
                    scrollPosition = DOMElements.display.scrollTop; 
                    updateHighlightAfterJump();
                    break;
                case 'ArrowRight': 
                    e.preventDefault();
                    DOMElements.display.scrollTop += 150; 
                    scrollPosition = DOMElements.display.scrollTop;
                    updateHighlightAfterJump();
                    break;
                case 'r': case 'R': e.preventDefault(); reset(); break;
                case 'f': case 'F':
                    e.preventDefault();
                    if (!document.fullscreenElement) document.documentElement.requestFullscreen();
                    else document.exitFullscreen();
                    break;
            }
        });
        
        // --- Initial Setup ---
        renderScript();
        updateKeyboardHelp();
    });
    </script>
</body>
</html>

